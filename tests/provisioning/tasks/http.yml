---
# Creates a http server block for use when testing

- name: ensure document root directory exists and has correct owner and permissions
  file:
     path="{{ webserver_virtual_hosts_document_root }}"
    owner="{{ nginx_config_core_user }}"
    group="{{ nginx_config_core_user }}"
     mode=0775
    state=directory

- name: ensure document root index file exists and has correct owner and permissions
  copy:
      src=data/var/www/html/index.html
     dest="{{ webserver_virtual_hosts_document_root }}/index.html"
    owner="{{ nginx_config_core_user }}"
    group="{{ nginx_config_core_user }}"
     mode=0664

- name: generate http server block definition file
  template:
     src=../../templates/etc/nginx/sites-available/server-block-http.j2
    dest=/etc/nginx/sites-available/test-http

- name: enable http server block definition file
  file:
      src=/etc/nginx/sites-available/test-http
     dest=/etc/nginx/sites-enabled/test-http
    state=link
  notify: Restart Nginx
